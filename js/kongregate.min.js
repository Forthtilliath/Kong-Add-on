"use strict";if(aFeatures.ping.display||aFeatures.botsblocker.display){var s=document.createElement("script");s.type="text/javascript",s.id="script_kong",aFeatures.urlrewriter.display&&(s.append("function getHtmlLink(type, value) {"),s.append("    if (type == 'wiki') {"),s.append("        let urlOut = '<a href=\"' + value[0] + '\" target=\"_blank\">[Wiki';"),s.append("        if ((value[3] != 'Idle_Grindia_Wiki') && (value[3] != 'Idle_Grindia')) {"),s.append("            if (value[4] && (value[4].length > 1)) {"),s.append("                urlOut += ' - ' + value[4].substr(1).replaceAll('_', ' ');"),s.append("            } else {"),s.append("                urlOut += ' - ' + value[3].replaceAll('_', ' ');"),s.append("            }"),s.append("        }"),s.append("        urlOut += ']</a>';"),s.append("        return urlOut;"),s.append("    }"),s.append("    if (type == 'game') {"),s.append("        let titleGame = '';"),s.append("        let aTitleGame = value[2].split('-');"),s.append("        for (let i = 0; i < aTitleGame.length; i++) {"),s.append("            titleGame += aTitleGame[i].substring(0, 1).toUpperCase() + aTitleGame[i].substring(1).toLowerCase() + ' ';"),s.append("        }"),s.append("        return '>[Game - ' + titleGame + ']<';"),s.append("    }"),s.append("    if (type == 'account') {"),s.append("        return '>[Account - ' + value[2] + ']<';"),s.append("    }"),s.append("}"),s.append("function urlRewritter(msg) {"),s.append("    let m;"),s.append("    let msgOut = msg;"),s.append("    let regWiki = "+regWiki+";"),s.append("    while ((m = regWiki.exec(msg)) !== null) {"),s.append("        msgOut = msgOut.replaceAll(m[0], getHtmlLink('wiki', m));"),s.append("    }"),s.append("    let regGame = "+regGame+";"),s.append("    while ((m = regGame.exec(msg)) !== null) {"),s.append("        msgOut = msgOut.replace(m[0], getHtmlLink('game', m));"),s.append("    }"),s.append("    let regAccount = "+regAccount+";"),s.append("    while ((m = regAccount.exec(msg)) !== null) {"),s.append("        msgOut = msgOut.replace(m[0], getHtmlLink('account', m));"),s.append("    }"),s.append("    msgOut = msgOut.replace(new RegExp('( ]</a>)([#])?','g'), ']</a>');"),s.append("    return msgOut;"),s.append("}")),aFeatures.botsblocker.display&&s.append("var websitesBlocked = "+$.getArrayDoubleToString(aBots)+";"),aFeatures.ping&&(s.append("var songMsg = new Audio('"+chrome.runtime.getURL(songUrl)+"');"),s.append("songMsg.volume = "+volumeValue+";")),s.append("ChatDialogue.prototype.displayUnsanitizedMessage = function (a, b, c, d) {"),s.append("    c || (c = {});"),s.append("    d || (d = {});"),s.append("    allow_mutes = (active_room = this._holodeck.chatWindow().activeRoom()) && !active_room.canUserModerate(active_room.self()) || d.whisper;"),s.append("    if (!allow_mutes || !this._chat_window.isMuted(a)) {"),s.append("        var e = d.non_user ? 'chat_message_window_undecorated_username' : 'chat_message_window_username',"),s.append("            g = a == this._chat_window.username(),"),s.append("            h = [];"),s.append("        e = [e];"),s.append("        var l = d['private'] ? 'To ' : '';"),s.append("        d.timestamp = d.timestamp ? new Date(d.timestamp) : new Date;"),s.append("        d.formatted_timestamp = d.timestamp.format('mmm d - h:MMTT');"),aFeatures.botsblocker.display&&(s.append("        for( var i = 0 ; i  < websitesBlocked.length ; i++ ) {"),s.append("            if( b.search(websitesBlocked[i][0]) >= 0 ) {"),debugLevel>=50&&s.append("                console.log(`${d.formatted_timestamp} : Bot detected [${a}] with the pattern [${websitesBlocked[i][0]}]`);"),s.append("                websitesBlocked[i][1]++;"),s.append("                return;"),s.append("            }"),s.append("        }")),aFeatures.ping.display&&s.append("        if( !g && !d.non_user ) songMsg.play();"),s.append("        this._messages_count % 2 && h.push('even');"),s.append("        c['class'] && h.push(c['class']);"),s.append("        g && e.push('is_self');"),s.append("        if (c = 'string' === typeof b ? null : b.stickerId) d.template = ChatDialogue.STICKER_MESSAGE_TEMPLATE, d.stickerId = c, d.stickerVariant = b.stickerVariant, d.stickerPackName = b.stickerPackName, d.stickerLevel = b.level, d.stickerQuality = 100 <= b.level ? b.quality + ' is-ranked' : b.quality, d.stickerUrl = this._sticker_manager.url(c, d.stickerVariant, 72);"),aFeatures.urlrewriter.display&&s.append("        b = urlRewritter(b);"),s.append("        a = this.messageContent({"),s.append("            prefix: l,"),s.append("            username: a,"),s.append("            message: b,"),s.append("            classNames: h.join(' '),"),s.append("            userClassNames: e.join(' '),"),s.append("            characterName: d.characterName,"),s.append("            timestamp: d.formatted_timestamp,"),s.append("            template: d.template,"),s.append("            stickerId: d.stickerId,"),s.append("            stickerVariant: d.stickerVariant,"),s.append("            stickerUrl: d.stickerUrl,"),s.append("            stickerLevel: d.stickerLevel,"),s.append("            stickerQuality: d.stickerQuality,"),s.append("            stickerPackName: d.stickerPackName"),s.append("        });"),s.append("        this.insert(a, null, {"),s.append("            timestamp: d.timestamp"),s.append("        });"),s.append("        this._messages_count++"),s.append("    }"),s.append("}"),$("head").append(s)}